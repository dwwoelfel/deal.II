dnl -------------------------------------------------------------
dnl
dnl Check for a problem with dynamic cast on dynamic libs on
dnl Mac OS X Snow Leopard. The test is only called on Mac OS X.
dnl The test is due to Scott Miller <scott.miller@psu.edu>
dnl
dnl -------------------------------------------------------------
AC_DEFUN(DEAL_II_CHECK_DYNAMIC_CAST_BUG,
[
  AC_MSG_CHECKING(for dynamic_cast problem with shared libs)

  if (cd contrib/config/tests/darwin-dynamic-cast ; \
      echo $CXX > compile_line; \
      $CXX -dynamiclib BaseClass.cpp -o libDynamicCastTestLib.dylib ; \
      $CXX -L. -lDynamicCastTestLib main.cc -o main ; \
      ./main) ; then
    AC_MSG_RESULT(no) ;
  else
    AC_MSG_RESULT(yes) ;
    AC_DEFINE(DEAL_II_HAVE_DARWIN_DYNACAST_BUG, 1,
              [Defined if the compiler has a bug with dynamic casting
               and dynamic libraries])
    if(test "`sw_vers -productVersion`" != "10.8");then
	CXXFLAGSG="$CXXFLAGSG -mmacosx-version-min=10.4"
	CXXFLAGSO="$CXXFLAGSO -mmacosx-version-min=10.4"
	LDFLAGS="$LDFLAGS -mmacosx-version-min=10.4"
    fi
  fi
  rm -f contrib/config/tests/darwin-dynamic-cast/libDynamicCastTestLib.dylib
  rm -f contrib/config/tests/darwin-dynamic-cast/main.o
  rm -f contrib/config/tests/darwin-dynamic-cast/main
])

/* Defined if the compiler has a bug with dynamic casting and dynamic
   libraries */
#cmakedefine DEAL_II_HAVE_DARWIN_DYNACAST_BUG

