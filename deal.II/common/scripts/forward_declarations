# rule how to make the file containing all the forward declarations
# taken from the deal.II Makefile
#
# to explain what this rule does:
#
# - create a file $@.old.
#   if the forward declaration file $@ already exists, then copy
#   it over, otherwise leave it empty. this way, we always have
#   a file to run diff on. send the output of the copy command
#   (which may fail) to nirvana.
# - write the forward declarations for the presently available
#   header files to $@.new. Use all header files except the 
#   forward declarations file itself
# - compare old and new forward-declarations files. if they
#   differ (i.e. the result of 'diff' is a nonzero string) copy
#   the nes file over the old one and thus also change the time 
#   stamp of that file. if they don't differ, then do nothing 
#   and in particular don't touch the time stamp to avoid that
#   'make' thinks it has to remake all object files
# - delete the two temporary files
$(forward-declarations): $(filter-out %forward-declarations%,$(h-files)) \
                         $D/common/scripts/forward_declarations.pl
	@echo ============================ Remaking $(@F)
	@touch $@.old
	@-cp $@ $@.old > /dev/null 2>&1
	@$(PERL) $D/common/scripts/forward_declarations.pl   \
              $(filter-out %$(notdir $(forward-declarations)),$(h-files)) \
            > $@.new
	@if test -n "`diff $(forward-declarations).old $(forward-declarations).new`" ; then \
	  echo "============================          file remade" ; \
	  cp $@.new $@ ; \
	else   \
	  echo "============================          file unchanged" ; \
        fi
	@rm $@.old $@.new
