<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
	  "http://www.w3.org/TR/html4/loose.dtd">
<html>
  <head>
    <title>Porting deal.II</title>
    <link href="../screen.css" rel="StyleSheet" media="screen">
    <meta name="author" content="the deal.II authors <authors@dealii.org>">
    <meta name="copyright" content="Copyright (C) 2000, 2001, 2002, 2005, 2010, 2012 by the deal.II authors">
    <meta name="date" content="$Date$">
    <meta name="svn_id" content="$Id$">
    <meta name="keywords" content="deal.II porting">
  </head>

  <body>


    <h1>Porting <acronym>deal.II</acronym> to new systems</h1>

    <p>
      <acronym>deal.II</acronym> uses very few system dependent
      features. Consequently, there is a good chance that it might also run on other
      systems besides the ones listed in the
      <a href="readme.html" targte="body">ReadMe file</a>. Nevertheless,
      there are cases where some adjustments are necessary.
    </p>


    <p>
      Basically, all the setup of the specifics or a system is done in the
      <code>./configure</code> script that is run first. This script finds out about
      operating system, processor, and the like, and then goes on testing
      whether certain features are present, or if their absence can be
      worked around.
      <code>./configure</code> is not made for human eyes. It is in fact only a
      script generated by the <code>autoconf</code> program from the files
      <code>configure.in</code> and <code>aclocal.m4</code> in the top-level directory of
      <acronym>deal.II</acronym>. The first contains the order in which
      macros are called that test for features, interspersed by shell
      script snippets that do actions depending on the results of the
      macros. The second file contains the user-defined macros used in
      <code>configure.in</code> (most macros are already predefined by autoconf).
      To understand how all this works together, you will have to have some, though
      not a whole lot of,
      knowledge of both Unix shell scripting as well as of <code>autoconf</code>
    </p>

    <p>
      At the end of running <code>./configure</code>, it creates output files by
      replacing all occurrences of variables like <code>@var@</code> in input files
      by the value of the respective environment variable in
      the <code>configure</code> shell script. By convention, input files have a
      file ending <code>.in</code>; the two most important input/output file pairs
      are <code>common/Make.global_options</code>
      and <code>common/Make.global_options.in</code>  as well as
      <code>include/deal.II/base/config.h.in</code>
      and <code>include/deal.II/base/config.h</code>.
    </p>



    <h2>Quick porting</h2>

    <p>
      If you find something that does not work on your system, then the
      quickest way to make <acronym>deal.II</acronym> run on your system
      is to run <code>configure</code> and change things in
      <code>common/Make.global_options</code> by hand so that it works for
      you. The downside is that
      this file is overwritten next time you run <code>./configure</code>.
    </p>

    <p>
      Most often, problems on new systems are caused by the compiler not
      accepting certain flags, crashing or producing invalid code on
      optimization flags, not supporting shared libraries, and the like.
      All these problems can be solved by changing
      <code>common/Make.global_options</code>, e.g. by setting the variable
      <code>enable-shared</code> to <code>no</code>, or by changing the compiler flags in
      the variables <code>CXXFLAGS.g</code> (for debug mode) or <code>CXXFLAGS.o</code> (for
      optimized mode). The most important variables in
      <code>common/Make.global_options</code> are
      <a href="development/makefiles.html">listed here</a>.
    </p>



    <h2>Portable porting</h2>

    <p>
      While the measures shown above make <acronym>deal.II</acronym> run
      on your system, it does not help other users. Neither does it mean
      that the next version will run on your system unless you do the same
      changes over again. There are basically two ways to help us make
      <acronym>deal.II</acronym> run on your system by default:
      <ul>
	<li>
	  <p>
	    You can send us the changes you had to make so that we can include
	    it into the distribution.
	  </p>

	<li>
	  <p>
	    If you know the basics of <code>autoconf</code>, or of shell scripting, you
	    will be able to write tests for the changes that are necessary in
	    <code>configure.in</code> or <code>aclocal.m4</code> yourself. There are plenty of examples, both for
	    things that we do depending on the system (for example disabling
	    shared libraries on certain systems) or depending on the compiler
	    (for example using some optimization flags for newer gcc
	    versions), and depending on the results of feature tests. For the
	    latter, you may for example take a look at the macro
	    <code>DEAL_II_CHECK_ASSERT_THROW</code> in <code>aclocal.m4</code> that shows how to
	    test whether the <code>AssertThrow</code> construct in
	    <acronym>deal.II</acronym> works as intended (this check is
	    necessary since some very old compiler versions get an internal compiler
	    error on DEC Alpha machines for this construct).
	  </p>

	  <p>
	    If you have made such changes to <code>configure.in</code> or
	    <code>aclocal.m4</code>, run <code>autoconf</code> in the top-level directory to
	    regenerate the <code>configure</code> script, which you should then run and
	    see whether the output in <code>common/Make.global_options</code> matches
	    your expectations.
	  </p>

	  <p>
	    Of course, we would be happy to hear about the changes you made
	    for your system, so that we can include them into the next version
	    of the library.
	  </p>
      </ul>
    </p>



    <hr>

    <address>
      <a href="mail.html" target="body">The deal.II Group</a>
    </address>

  </body>
</html>
