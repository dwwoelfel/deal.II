<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-1 (1.68)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The elastic equations</TITLE>
<META NAME="description" CONTENT="The elastic equations">
<META NAME="keywords" CONTENT="assemble">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="assemble.css">

<LINK REL="next" HREF="node14.html">
<LINK REL="previous" HREF="node10.html">
<LINK REL="up" HREF="node10.html">
<LINK REL="next" HREF="node14.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html150"
  HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="../deal.II-paper/next_motif.gif"></A> 
<A NAME="tex2html148"
  HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="../deal.II-paper/up_motif.gif"></A> 
<A NAME="tex2html142"
  HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="../deal.II-paper/previous_motif.gif"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html151"
  HREF="node14.html">The Stokes equations</A>
<B> Up:</B> <A NAME="tex2html149"
  HREF="node10.html">Assembling vector-valued problems: The</A>
<B> Previous:</B> <A NAME="tex2html143"
  HREF="node12.html">Evaluating shape functions</A>
<BR>
<BR>
<!--End of Navigation Panel-->

<H2><A NAME="SECTION00061000000000000000">
The elastic equations</A>
</H2>

<P>
With the above, we can now assemble the matrix for the elastic equation in
mostly the same way as before. The difference is that for each shape function,
we have to loop over all components. The code then looks like this (compare
this with the one in Section&nbsp;<A HREF="node8.html#sec:elastic-simple">5.1</A>):
<PRE>
  for (unsigned int i=0; i&lt;fe.dofs_per_cell; ++i)
    for (unsigned int comp_i=0; comp_i&lt;fe.n_components(); ++comp_i)
      for (unsigned int j=0; j&lt;fe.dofs_per_cell; ++j)
        for (unsigned int comp_j=0; comp_j&lt;fe.n_components(); ++comp_j)
          for (unsigned int q=0; q&lt;n_q_points; ++q) 
            {
                           // first assemble part with lambda+mu
              cell_matrix(i,j)
                 += ((lambda+mu)                       *
                     fe_values.shape_grad_component(i,q,comp_i)[comp_i] * 
                     fe_values.shape_grad_component(j,q,comp_j)[comp_j] *
                     fe_values.JxW(q)); 

                           // then part with mu only
              if (comp_i == comp_j)
                cell_matrix(i,j)
                  += (mu                           *
                      (fe_values.shape_grad_component(i,q,comp_i) * 
                       fe_values.shape_grad_component(j,q,comp_j)  )*
                       fe_values.JxW(q)); 
            };
</PRE>
If you dislike this particular order of the loops, you can reorder them as you
like, as they are independent.

<P>
The code as shown above can be optimized. For example, instead of
unconditionally performing the loop over all components of shape functions <IMG
 WIDTH="10" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img33.gif"
 ALT="$ i$">
of <IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img83.gif"
 ALT="$ j$">, we might first ask whether these shape functions are primitive, using
<TT>fe.is_primitive(i)</TT>, and use the loop only if the result is false;
if, on the other hand, the result is true, we only need to set
<TT>comp_i</TT> to the fixed value
<TT>fe.system_to_component_index(i).first</TT>, and likewise for shape
function <IMG
 WIDTH="12" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img83.gif"
 ALT="$ j$">.

<P>
Another possibility for optimization would be to ask whether a certain
component over which we loop is actually non-zero, or if the shape function is
a non-primitive one but happens to be zero in the present component
nevertheless. For this, we could replace the loop over <TT>comp_i</TT> by
this:
<PRE>
    for (unsigned int comp_i=0; comp_i&lt;fe.n_components(); ++comp_i)
      if (fe.get_nonzero_components(i)[comp_i] == true)
</PRE>
If the if-clause does not succeed then this component of the shape function is
definitely zero, and there will not be a contribution to the matrix anyway, so
we can also skip the computations.

<P>
<HR>
<!--Navigation Panel-->
<A NAME="tex2html150"
  HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next"
 SRC="../deal.II-paper/next_motif.gif"></A> 
<A NAME="tex2html148"
  HREF="node10.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up"
 SRC="../deal.II-paper/up_motif.gif"></A> 
<A NAME="tex2html142"
  HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous"
 SRC="../deal.II-paper/previous_motif.gif"></A>   
<BR>
<B> Next:</B> <A NAME="tex2html151"
  HREF="node14.html">The Stokes equations</A>
<B> Up:</B> <A NAME="tex2html149"
  HREF="node10.html">Assembling vector-valued problems: The</A>
<B> Previous:</B> <A NAME="tex2html143"
  HREF="node12.html">Evaluating shape functions</A>
<!--End of Navigation Panel-->
<ADDRESS>
Wolfgang Bangerth
2002-06-14
</ADDRESS>
</BODY>
</HTML>
