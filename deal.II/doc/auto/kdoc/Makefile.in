############################################################
# $Id$
############################################################

D           = @DEAL2_DIR@
multigrid   = @enablemultigrid@
kdocdir     = @kdocdir@
kdocversion = @kdocversion@


include $D/common/Make.global_options

ifeq ($(kdocversion),1)
KDOCFLAGS=-I$(kdocdir) $(kdocdir)/kdoc -a -p -L $D/doc/auto/kdoc
else
KDOCFLAGS=-I$(kdocdir) $(kdocdir)/kdoc -a -p -L $D/doc/auto/kdoc -n 
endif

kdoc.base     = $(shell echo $D/base/include/base/*.h)
kdoc.lac      = $(shell echo $D/lac/include/lac/*.h)
kdoc.grid     = $(shell echo $D/deal.II/include/grid/*.h)
kdoc.dof      = $(shell echo $D/deal.II/include/dofs/*.h) \
                $(shell echo $D/deal.II/include/fe/*.h)
kdoc.numerics = $(shell echo $D/deal.II/include/numerics/*.h)
kdoc.multigrid= $(shell echo $D/deal.II/include/multigrid/*.h)


# specify the names of the resulting doc libraries
ifeq ($(multigrid),yes)
kdoc.library-files = base.kdoc         \
                     lac.kdoc          \
                     grid.kdoc         \
                     dof.kdoc          \
                     numerics.kdoc     \
                     multigrid.kdoc
else
kdoc.library-files = base.kdoc         \
                     lac.kdoc          \
                     grid.kdoc         \
                     dof.kdoc          \
                     numerics.kdoc
endif

kdoc: kdoc-installed $(kdoc.library-files)


# check whether kdoc is already installed. if not, then try to do so
kdoc-installed:
	@if test ! -d $(kdocdir) ; then  \
	    echo "========================================" ; \
	    echo "Trying to install kdoc first" ;  \
	    echo "========================================" ; \
	    cd $(kdocdir:kdoc/bin=kdoc) ;    \
	    $(MAKE) install ;  \
	    echo "========================================" ; \
	    echo "Done" ;  \
	    echo "========================================" ; \
        fi

base.kdoc: kdoc-installed $(kdoc.base)
	@$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	$(^:kdoc-installed=)

lac.kdoc: kdoc-installed $(kdoc.lac)
	@$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	-l base $(^:kdoc-installed=)

grid.kdoc: kdoc-installed $(kdoc.grid)
	@$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	-l base $(^:kdoc-installed=)

dof.kdoc: kdoc-installed $(kdoc.dof)
	$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	-l base -llac -lgrid $(^:kdoc-installed=)

numerics.kdoc: kdoc-installed $(kdoc.numerics)
	@$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	-l base -llac -lgrid -ldof $(^:kdoc-installed=)

multigrid.kdoc: kdoc-installed $(kdoc.multigrid)
	@$(PERL) $(KDOCFLAGS) $(subst .kdoc,,$@) -d $(subst .kdoc,,$@) \
	-l base -llac -lgrid -ldof -lnumerics $(^:kdoc-installed=)

