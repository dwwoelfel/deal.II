# $Id$

#
# Compatibility Make.global_options file
#

# TODO: Update the old comment and put it back again
#
# - Setup OBJEXT and EXEEXT in a way this makefile expects them
#
# ***   ISSUES   ***
#
# - What is LIBS for? There is this other mechanism for specifying
#   full paths of necessary libraries. We know all the libraries with full
#   path, so we just use the latter mechanism and leave LIBS empty for now.
#
# - The link line "$(CXX) -o $@ <libraries> $(LIBS) $(LDFLAGS)"
#   of the examples is broken. LDFLAGS should be in front. As a workaround,
#   we have to specify the rpath flags ${MAKEFILE_RPATHFLAGS} directly in
#   front of the libraries.
#
# TODO: Set up the other configuration variables that are currently
# removed...
#


D                    = @CMAKE_INSTALL_PREFIX@
CXX                  = @CMAKE_CXX_COMPILER@
CXX-ID               = @CMAKE_CXX_COMPILER_ID@
CXX-VERSION          = @CMAKE_CXX_COMPILER_VERSION@
CC                   = @CMAKE_C_COMPILER@
CC-ID                = @CMAKE_C_COMPILER_ID@
CC-VERSION           = @CMAKE_C_COMPILER_VERSION@
AR                   = @CMAKE_AR@
RANLIB               = @CMAKE_RANLIB@
LDFLAGS              = @MAKEFILE_LDFLAGS@

LIBS                 = #Empty

LIBDIR               = @CMAKE_INSTALL_PREFIX@/@DEAL_II_LIBRARY_RELDIR@

enable-threads       = @MAKEFILE_enablethreads@
enable-shared        = @MAKEFILE_enableshared@
enable-parser        = @MAKEFILE_enableparser@
DEAL_II_VERSION      = @VERSION@
DEAL_II_MAJOR        = @DEAL_II_MAJOR@
DEAL_II_MINOR        = @DEAL_II_MINOR@

DEAL_II_USE_MPI      = @DEAL_II_WITH_MPI@

#TARGET               = @target@ # TODO

######################################################
# now configuration for compiler flags, paths, etc

# path for libraries

LIBPATH    += $(addprefix -L,$(LIBDIR))

static-lib-suffix = @CMAKE_STATIC_LIBRARY_SUFFIX@
shared-lib-suffix = @CMAKE_SHARED_LIBRARY_SUFFIX@

ifeq ($(enable-shared),yes)
   lib-suffix = $(shared-lib-suffix)
else
   lib-suffix = $(static-lib-suffix)
endif

# add search path for libraries to make dependencies
vpath %@static_lib_suffix@ $(LIBDIR)
vpath %@shared_lib_suffix@ $(LIBDIR)

OBJEXT     = o # TODO: @CMAKE_CXX_OUTPUT_EXTENSION@ :-*
EXEEXT     = @EXEEXT@ # TODO



# set paths to all the libraries we need:
lib-deal2.o     = ${MAKEFILE_RPATHFLAGS} ${MAKEFILE_LIBRARIES}
lib-deal2.g     = ${MAKEFILE_RPATHFLAGS} ${MAKEFILE_LIBRARIES}


# necessary includes:
INCLUDE = ${MAKEFILE_INCLUDE_DIRS}


# compiler flags for debug and optimized mode
CXXFLAGS.g   = @CMAKE_CXX_FLAGS@ @CMAKE_CXX_FLAGS_DEBUG@ @MAKEFILE_DEFINITIONS@ $(INCLUDE)
CXXFLAGS.o   = @CMAKE_CXX_FLAGS@ @CMAKE_CXX_FLAGS_RELEASE@ @MAKEFILE_DEFINITIONS@ $(INCLUDE)


# compile flags for C compiler
CFLAGS.g   = @CMAKE_C_FLAGS@ @CMAKE_C_FLAGS_DEBUG@ @MAKEFILE_DEFINITIONS@
CFLAGS.o   = @CMAKE_C_FLAGS@ @CMAKE_C_FLAGS_RELEASE@ @MAKEFILE_DEFINITIONS@


ifneq ($(enable-threads),no)
  MT = MT
else
  MT = ==
endif


ifeq ($(BUILDTEST),yes)
print-summary:
	@svn info .. | perl -ne 'print "dealii-feature: revision=$$_\n" if s/Revision: //; print "dealii-feature: branch=$$1\n" if m/svn\/dealii\/(.+)\/deal.II/;'
	@echo "dealii-feature: user=$(USER)"
	@echo "dealii-feature: host=`hostname`"
	@echo "dealii-feature: target=$(TARGET)"
	@echo "dealii-feature: compiler=$(GXX-VERSION-DETAILED)"
	@echo "dealii-feature: multithreading=$(enable-threads)"
	@echo "dealii-feature: shared_libs=$(enable-shared)"
	@echo "dealii-feature: METIS=$(subst no,,$(USE_CONTRIB_METIS))"
	@cd $D/common/scripts ; make report_features && ./report_features
endif
